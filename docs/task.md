# タスクリスト

## データベース設計タスク

### 1. データベーススキーマの詳細設計
- [x] `documents`テーブルの完全なスキーマ定義
  - タイトル、URL、summeryフィールドが定義済み
  - summeryフィールドにインデックス追加済み
  - 制約条件の設定
- [x] `chat_session`テーブルのスキーマ定義
  - session_key、user_agent、page_urlフィールドが定義済み
  - 有効期限の管理方法（実装が必要）
- [x] `chat_message`テーブルのスキーマ定義
  - chat_session_id（外部キー制約付き）、message、screen_shot_urlフィールドが定義済み
  - メッセージ種別の定義（実装が必要）
- [x] `issues`テーブルのスキーマ定義
  - chat_session_id（外部キー制約付き）、message、screen_shot_urlフィールドが定義済み
  - chat_sessionとの関連付け済み
- [x] テーブル間のリレーション定義（外部キー制約の追加）
- [x] マイグレーションファイルの作成

### 2. データベースパフォーマンス設計
- [ ] 検索用インデックスの設計
  - documentsテーブルのtitleフィールドへの全文検索インデックス（summeryは追加済み）
  - chat_sessionsテーブルのsession_keyへのインデックス
  - chat_messages、issuesテーブルのchat_session_idへのインデックス（外部キー制約で自動追加済み）
- [ ] 同時接続数に応じた設定調整
- [ ] バックアップ戦略の策定

## 認証・認可システムタスク

### 3. 認証システムの実装
- [x] ユーザー管理システムの設計（Devise導入済み）
- [ ] Bearer認証の実装方法の決定（JWT vs APIキー）
- [ ] セッション管理の実装
- [ ] 認証ミドルウェアの作成

### 4. 認可システムの実装
- [ ] アクセス制御の設計
- [ ] 権限管理の実装
- [ ] セキュリティヘッダーの設定

## 検索機能タスク

### 5. 検索ロジックの実装
- [ ] ドキュメント検索アルゴリズムの選択
  - 全文検索エンジンの選定（Elasticsearch、PostgreSQL Full-Text Search等）
  - キーワードマッチングロジックの実装
  - documentsテーブルのtitle、summery（インデックス済み）フィールドを対象とした検索
- [ ] 検索結果のランキングアルゴリズムの実装
- [ ] 検索精度向上のための機能実装
  - 同義語対応
  - 曖昧検索
  - 関連度スコアリング

### 6. 検索結果の判定ロジック
- [ ] 「検索結果が見つからない」の判定基準の定義
- [ ] 不具合報告への自動遷移ロジック
- [ ] 検索結果の品質評価機能

## 画像処理タスク

### 7. 画像処理システムの実装
- [x] 画像保存方法の決定
  - MinIO（S3互換）を使用したオブジェクトストレージ
  - 画像フォーマットの制限
- [x] 画像の用途と処理方法の定義
  - スクリーンショットの処理（screen_shot_urlフィールドで管理）
  - 添付ファイルの管理
- [ ] 画像の圧縮・リサイズ機能
- [ ] 画像のセキュリティ対策

## API設計・実装タスク

### 8. APIエンドポイントの実装
- [ ] `/chat`エンドポイントの完全実装
  - documentsテーブルからtitle、url、summery（インデックス活用）を検索
  - chat_sessions、chat_messagesテーブルへのログ記録
- [ ] `/issue`エンドポイントの完全実装
  - issuesテーブルへの不具合報告保存
  - chat_session_idとの関連付け
- [ ] リクエスト・レスポンスのバリデーション
- [ ] エラーハンドリングの実装
- [ ] APIドキュメントの作成

### 9. エラーハンドリングの詳細設計
- [ ] エラー時のレスポンス形式の標準化
- [ ] 不具合報告の処理フローの詳細設計
- [ ] ログ出力の標準化

## パフォーマンス・運用タスク

### 10. パフォーマンス要件の定義
- [ ] 検索応答時間の要件定義
- [ ] 同時接続数の要件定義
- [ ] 負荷テストの実施計画

### 11. 運用・監視システムの構築
- [ ] ログの保存期間の決定
- [ ] 監視項目の定義
- [ ] アラート設定の構築
- [ ] メトリクス収集の実装

## テスト・品質保証タスク

### 12. テスト計画の策定
- [ ] 単体テストの作成
- [ ] 統合テストの作成
- [ ] E2Eテストの作成
- [ ] パフォーマンステストの作成

### 13. セキュリティテスト
- [ ] 認証・認可のテスト
- [ ] 入力値検証のテスト
- [ ] SQLインジェクション対策のテスト

## ドキュメント・デプロイタスク

### 14. ドキュメント整備
- [ ] API仕様書の詳細化
- [ ] 運用マニュアルの作成
- [ ] 開発者向けドキュメントの作成

### 15. デプロイメント準備
- [x] ローカル環境のコンテナ設定完了
  - Railsアプリケーション（app）
  - PostgreSQLデータベース（db）
  - Nginxリバースプロキシ（nginx）
  - MinIOオブジェクトストレージ（minio）
- [ ] ECS設定の詳細化
- [ ] RDS設定の最適化
- [ ] CI/CDパイプラインの構築
- [x] 環境変数の管理方法の決定（docker-compose.ymlで管理）

## 優先度

### 高優先度（MVP実装に必須）
1. ✅ データベーススキーマの詳細設計
2. 🔄 認証システムの実装（Devise導入済み、Bearer認証実装が必要）
3. 検索ロジックの実装
4. APIエンドポイントの実装

### 中優先度（品質向上）
5. 🔄 画像処理システムの実装（MinIO設定完了、画像処理機能実装が必要）
6. エラーハンドリングの詳細設計
7. テスト計画の策定

### 低優先度（運用・拡張）
8. パフォーマンス要件の定義
9. 運用・監視システムの構築
10. 🔄 ドキュメント整備（README更新済み）
11. 🔄 デプロイメント準備（ローカル環境設定完了） 